<?xml version="1.0" encoding="utf-8"?>


<setup xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="https://www.benerator.de/schema/1.0.0"
       xsi:schemaLocation="https://www.benerator.de/schema/1.0.0 https://www.benerator.de/schema/benerator-1.0.0.xsd">

    <comment>setting default values</comment>
    <setting name="transaction_count" default="100"/>
    <import domains="person"/>

    <generate type="transaction"
              count="{transaction_count}"
              consumer="new XLSEntityExporter('targets/demoxls.out.xlsx')">
        <variable name="person" generator="PersonGenerator"/>
        <attribute name="id" generator="IncrementGenerator"/>
        <attribute name="email" pattern="[a-z]{5,8}[0-9]{0,2}@[a-z]{8,12}\.(de|at|ch|com|org)"/>
        <attribute name="password" pattern="[A-Za-z0-9]{8,12}"/>
        <attribute name="role_id" constant="customer"/>
        <attribute name="category" values="'A','B','C'"/>
        <attribute name="salutation" script="person.salutation"/>
        <attribute name="first_name" script="person.givenName"/>
        <attribute name="last_name" script="person.familyName"/>
    </generate>

    <iterate type="transaction" source="target/demoxls.out.xlsx" consumer="NoConsumer">
        <attribute name="counter" type="int" generator="IncrementGenerator"/>
    </iterate>
    <if test="transaction.counter != transaction_count">
        <error>{ftl: ${transaction.counter} transaction instead of ${transaction_count}}</error>
    </if>
    <echo>{ftl: ${transaction_count} transaction has been successfully processed}</echo>
</setup>